---
layout: post
title: 使iMac2011无线连接TP-LINK的300M路由器
---

###症状
iMac 2011可以连接TP-LINK的无线路由器，但之后被分配169开头的ip，无法连接互联网。

此时TP-LINK的无线参数被设置为`b/g/n mixed`或者`n only`，且加密方式为`WPA/WPA2`。


###之前的解决办法
由于很多人装了双系统，同样的设置在Win下可以发现无线连接完全正常，所以不是硬件问题。

网上的解决方法主要有以下两种：

1. 更改加密方式为`wep`加密。
2. 修改无线模式为`802.11g`。

但按住option再点按你的无线图标可以发现，这两种操作都使你的路由器运作在**802.11g**模式，其最大传输速率为56Mbps。而出现这种问题的路由器，应该都是300M系列的产品（下面会解释原因），也就是说你的局域网传输速率在信号最好的情况下应该为300Mbps。

###背景知识
虽然执着着想要证明我能以最高速度正常连接，还是有些话说在前面。在数据传输的语境内，我们一般用`bit`而不是`Byte`作为单位，区分的办法就是大小写。另外bit是十进制的，Byte使用二进制：1KB是1024B而1Kb是1000b。

我们在讨论家庭宽带时常以`M`作为单位，其实完整的单位是`Mbps`，这个语境中，老式的ADSL的512k、1M和现在光纤的10M，20M和我们使用的路由器上写的150M、300M是可比的。说到这里你就会发现，其实你的宽带接入速度只有10M，而你早早就买了一个300M的路由器，还在纠结他以56M的速度连接实在太慢了的问题，确实有一点神经质。

计算机上显示的传输速度或下载速度是以`Byte`为单位的，将以`bit`为单位的值除以8就好了。比如上节解决办法中的56Mbps，换算为局域网内传输速度应该是7MBps。比一般的U盘略快一些。如果实现了300M，理论上传输速度为这个速度的6倍，实际呢？还是7MBps左右。

所以即使解决了高速连接问题，但并不是实际速度就会快了的，互联网速度的20M确实可以用迅雷什么达到，但继续增加后，由于无线传输的本身限制，速度增长会很少。我不断的追求高速其实和我需要在局域网无线流播放高清影片有关，就是从我的电脑到电视。如果你本身只有一两台不需要互联的设备，由以上的解释你大概会觉得你不需要继续看下去了。改成11g模式，wep密码继续使用吧。

###原因
`802.11`是无线局域网的国际标准，由其历史可以发现它在传输速度，覆盖范围这两个主要问题上摇摆不定，所以不断推出子标准a、b、g、n等等，而且各个标准并不简单的是一个比一个快。

TP-LINK WR841N以300M作为卖点，但其实它只支持2.4gHz的发射频率，而且默认自动选择了非规范的40MHz信道，比b/g所支持的20gHz宽了一倍，然后自说自话称自己可以达到300M。在部署的规范中，2.4gHz下的40MHz非常不被推荐，而这也就是2011iMac不能连上无线的原因。

###解决方法
把自动的频段带宽设置为20MHz，依然可以使用b/g/n混合模式或者n only。但是传输速度也回到了正常的150M。
只有在5GHz的发射频率下，11n才支持150M以上的传输速率。这时使用40MHz就不会有任何问题了。

###结论
即使是路由器也不要相信国产货。

